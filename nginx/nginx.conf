worker_processes  1;
events { worker_connections  1024; }

http {
    # ① 拡張子ごとの MIME は必ず読み込む
    include       mime.types;
    default_type  application/octet-stream;
    client_max_body_size 50m;

    # ② upstream 定義
    upstream chat     { server chat:8000; }
    upstream minutes  { server minutes:8000; }
    upstream frontend { server frontend:80; }  # ← 静的 SPA (別コンテナ)

    server {
        listen 80;
        server_name localhost;

        # ③ ---- API リバースプロキシ -------------------------------------------------
        location /chat/    { proxy_pass http://chat/; }
        location /minutes/ { proxy_pass http://minutes/; }

        # ④ ---- SPA (React build) ----------------------------------------------------
        # ルート `/` 以下はすべて frontend コンテナに転送
        location / {
            proxy_pass         http://frontend/;
            proxy_set_header   Host $host;
        }
    }
}
